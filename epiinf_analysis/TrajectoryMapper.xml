<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core
                  :beast.core.parameter
                  :beast.evolution.tree
                  :feast.expressions
                  :feast.fileio.logfileiterator" version="2.0">

  <run spec="LogFileIterator">
    <logFileState spec="TraceLogFileState" logFileName="Results/BD_epi.clock_$(clock).bu_$(bu).$(idx).log">
      <logFileEntry spec="LogFileRealParameter" fieldName="reproductiveNumber1" fieldParameterIndex="4">
        <fieldParameter id="Re" spec="RealParameter" dimension="5" value="0.0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="reproductiveNumber2" fieldParameterIndex="3">
        <fieldParameter idref="Re"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="reproductiveNumber3" fieldParameterIndex="2">
        <fieldParameter idref="Re"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="reproductiveNumber4" fieldParameterIndex="1">
        <fieldParameter idref="Re"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="reproductiveNumber5" fieldParameterIndex="0">
        <fieldParameter idref="Re"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportion1" fieldParameterIndex="1">
        <fieldParameter id="sampProp" spec="RealParameter" dimension="2" value="0.0"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="samplingProportion2" fieldParameterIndex="0">
        <fieldParameter idref="sampProp"/>
      </logFileEntry>
      <logFileEntry spec="LogFileRealParameter" fieldName="origin">
        <fieldParameter id="origin" spec="RealParameter" value="0.0"/>
      </logFileEntry>
    </logFileState>

    <logFileState spec="TreeLogFileState" logFileName="Results/BD_epi.clock_$(clock).bu_$(bu).$(idx).trees">
      <tree spec="beast.evolution.tree.Tree" id="tree"/>
    </logFileState>

    <logger spec="Logger"
            logEvery="1000000">
      <log idref="Re"/>
      <log idref="sampProp"/>
      <log id="treestat" spec="TreeStatLogger" tree="@tree"/>
    </logger>

    <logger spec="Logger"
            fileName="Results/BD_epi.clock_$(clock).bu_$(bu).$(idx).traj"
            logEvery="100000">
      <log spec="epiinf.TrajectoryLogger"
           logMostRecentTrajectory="true">
        <treeDensity id="treePrior" spec="epiinf.distribs.SMCTreeDensity"
                     tree="@tree"
                     nParticles="1000"
                     useTauLeaping="true">
          
          <model spec="epiinf.models.BirthDeathModel"
                 infectionRateShiftTimesBackward="true"
                 origin="@origin"
                 psiSamplingVariable="@sampProp"
                 psiSamplingVariableShiftTimesBackward="true"
                 rhoSamplingTimesBackward="true"
                 usePsiSamplingProportion="true">

            <infectionRate spec="ExpCalculator"
                           value="$(bu)*Re">
              <arg idref="Re"/>
            </infectionRate>

            <infectionRateShiftTimes spec="ExpCalculator"
                                     value="origin*{1,2,3,4}/5">
              <arg idref="origin"/>
            </infectionRateShiftTimes>

            <recoveryRate spec="ExpCalculator"
                           value="$(bu)*(1-sampProp)">
              <arg idref="sampProp"/>
            </recoveryRate>
            
            <removalProb spec="parameter.RealParameter" value="1.0" estimate="false"/>
            <rhoSamplingProb spec="parameter.RealParameter" value="0.0" estimate="false"/>
            <rhoSamplingTime spec="parameter.RealParameter" value="0.0" estimate="false"/>
          </model>
          
          <finalTreeSampleOffset spec="parameter.RealParameter" value="0.0" estimate="false"/>
        </treeDensity>
      </log>
    </logger>
  </run>
</beast>
