<?xml version="1.0" encoding="UTF-8" standalone="no"?><beast beautitemplate='Standard' beautistatus='' namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" version="2.0">

<map name="Uniform" >beast.math.distributions.Uniform</map>
<map name="Exponential" >beast.math.distributions.Exponential</map>
<map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal" >beast.math.distributions.Normal</map>
<map name="Beta" >beast.math.distributions.Beta</map>
<map name="Gamma" >beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution" >beast.math.distributions.LaplaceDistribution</map>
<map name="prior" >beast.math.distributions.Prior</map>
<map name="InverseGamma" >beast.math.distributions.InverseGamma</map>
<map name="OneOnX" >beast.math.distributions.OneOnX</map>

<alignment spec="feast.fileio.AlignmentFromFasta" id="alignment"
           fileName="ncov-wa.fasta"/>

<run id="mcmc" spec="MCMC" chainLength="10000000">
    <state id="state" storeEvery="1000">
        <tree id="Tree.t:alignment" name="stateNode">
          <trait id="dateTrait.t:alignment" spec="feast.fileio.TraitSetFromTaxonSet"
                 delimiter="|"
                 takeGroup="1"
                 traitname="date"
                 dateFormat="yyyy-M-dd">
            <taxa id="taxonSet" spec="TaxonSet" alignment="@alignment"/>
          </trait>
          <taxonset idref="taxonSet"/>
        </tree>
        <parameter id="kappa" lower="0.0" name="stateNode">2.0</parameter>
        <parameter id="reproductiveNumber" lower="0.0" name="stateNode" upper="Infinity" dimension="5">2.0</parameter>
        <parameter id="origin" lower="0.0" name="stateNode" upper="Infinity">1</parameter>
        <parameter id="gammaShape" spec="parameter.RealParameter" name="stateNode">1.0</parameter>
        <parameter id="samplingProportion" dimension='1' lower="0.0" name="stateNode" upper="1.0">0 0.01</parameter>
        <!-- <parameter id="ReSmoothingPrecision" name="stateNode" lower="0.0">1.0</parameter> -->
    </state>

    <init id="RandomTree.t:alignment" spec="beast.evolution.tree.RandomTree" estimate="false" initial="@Tree.t:alignment" taxa="@alignment">
        <populationModel id="ConstantPopulation0.t:alignment" spec="ConstantPopulation">
            <parameter id="randomPopSize.t:alignment" name="popSize">0.01</parameter>
        </populationModel>
    </init>


    <distribution id="posterior" spec="util.CompoundDistribution">
        <distribution id="prior" spec="util.CompoundDistribution">

          <distribution id="treePrior" spec="beast.evolution.speciation.BirthDeathSkylineModel"
                        origin="@origin"
                        reproductiveNumber="@reproductiveNumber"
                        samplingProportion="@samplingProportion"
                        tree="@Tree.t:alignment">
            <parameter id="becomeUninfectiousRate" name="becomeUninfectiousRate" value="$(burate)"/>

            <reverseTimeArrays spec="parameter.BooleanParameter" value="true true true true true"/>
            <!-- <birthRateChangeTimes spec="parameter.RealParameter" value="0.0 0.0574948665297741"/> -->
            <samplingRateChangeTimes spec="parameter.RealParameter" value="0.0 0.06571"/>
          </distribution>

            <!-- Treeprior priors -->

            <distribution spec="beast.math.distributions.MarkovChainDistribution"
                          shape="1.0"
                          useLogNormal="true">
              <parameter spec="feast.function.Reverse" arg="@reproductiveNumber"/>
              <!-- <shape idref="ReSmoothingPrecision"/> -->
            </distribution>

            <prior id="Re0prior" name="distribution">
              <x spec="Slice" arg="@reproductiveNumber" index="4" count="1"/>
              <LogNormal name="distr" M="0.8" S="0.5" offset="0.0"/>
            </prior>

            <!-- <prior name="distribution" x="@ReSmoothingPrecision"> -->
            <!--   <Exponential mean="1.0"/> -->
            <!-- </prior> -->

            <prior id="samplingProportionPrior" name="distribution" x="@samplingProportion">
                <Uniform id="unif1" name="distr" lower="0.0" upper="1.0"/>
            </prior>
            <prior id="originPrior" name="distribution" x="@origin">
              <!-- <OneOnX name="distr"/> -->
              <LogNormal id="LogNormalDistributionModel.03" name="distr">
                  <parameter estimate="false" name="M">-2</parameter>
                  <parameter estimate="false" lower="0.0" name="S" upper="5.0">0.8</parameter>
              </LogNormal>
            </prior>

            <prior id="KappaPrior" name="distribution" x="@kappa">
                <LogNormal id="LogNormalDistributionModel.04" name="distr">
                    <parameter estimate="false" name="M">1.0</parameter>
                    <parameter estimate="false" name="S">1.25</parameter>
                </LogNormal>
            </prior>

            <prior id="GammaShapePrior" name="distribution" x="@gammaShape">
                <Exponential name="distr">
                    <parameter estimate="false" name="mean">0.5</parameter>
                </Exponential>
            </prior>

        </distribution>
        <distribution id="likelihood" spec="util.CompoundDistribution">
          <distribution id="treeLikelihood.alignment" spec="ThreadedTreeLikelihood" data="@alignment" tree="@Tree.t:alignment">
              <siteModel id="SiteModel.s:alignment" spec="SiteModel" gammaCategoryCount="4" shape="@gammaShape">
                  <parameter id="mutationRate.s:alignment" estimate="false" name="mutationRate">1.0</parameter>
                  <parameter id="proportionInvariant.s:alignment" estimate="false" lower="0.0" name="proportionInvariant" upper="1.0">0.0</parameter>
                  <substModel id="hky" spec="HKY" kappa="@kappa">
                      <frequencies id="empiricalFreqs" spec="Frequencies" data="@alignment"/>
                  </substModel>
              </siteModel>
              <branchRateModel id="StrictClock.c:alignment" spec="beast.evolution.branchratemodel.StrictClockModel">
                <parameter id="clockRate.c:alignment" lower="0.0" name="clock.rate" upper="Infinity" value="$(clockrate)"/>
              </branchRateModel>
          </distribution>
        </distribution>
    </distribution>

    <operator id="KappaScaler" spec="ScaleOperator" parameter="@kappa" scaleFactor="0.5" weight="0.1"/>

	  <operator id="BDSKY_serialtreeScaler.t:tree" spec="ScaleOperator" scaleFactor="0.801" tree="@Tree.t:alignment" weight="3.0"/>

    <operator id="BDSKY_serialtreeRootScaler.t:tree" spec="ScaleOperator" rootOnly="true" scaleFactor="0.728" tree="@Tree.t:alignment" weight="3.0"/>

    <operator id="BDSKY_serialUniformOperator.t:tree" spec="Uniform" tree="@Tree.t:alignment" weight="30.0"/>

    <operator id="BDSKY_serialSubtreeSlide.t:tree" spec="SubtreeSlide" size="0.835" tree="@Tree.t:alignment" weight="15.0"/>

    <operator id="BDSKY_serialnarrow.t:tree" spec="Exchange" tree="@Tree.t:alignment" weight="15.0"/>

    <operator id="BDSKY_serialwide.t:tree" spec="Exchange" isNarrow="false" tree="@Tree.t:alignment" weight="3.0"/>

    <operator id="BDSKY_serialWilsonBalding.t:tree" spec="WilsonBalding" tree="@Tree.t:alignment" weight="3.0"/>

    <operator id="reproductiveNumberScaler" spec="ScaleOperator" parameter="@reproductiveNumber" scaleFactor="0.75" weight="10.0"/>

    <!-- <operator id="reSmoothingPrecisionScaler" spec="ScaleOperator" parameter="@ReSmoothingPrecision" scaleFactor="0.75" weight="10.0"/> -->

    <operator id="samplingScaler" spec="ScaleOperator" parameter="@samplingProportion" scaleFactor="0.75" weight="2.0"/>

    <operator id="origScaler" spec="ScaleOperator" parameter="@origin" scaleFactor="0.75" weight="1.0"/>

    <operator id="gammaShape_operator" spec="ScaleOperator" parameter="@gammaShape" scaleFactor="0.5" weight="0.1"/>

    <operator id="updownBS" spec="UpDownOperator" scaleFactor="0.75" weight="2.0">
      <up idref="samplingProportion"/>
      <down idref="reproductiveNumber"/>
    </operator>

    <logger id="screenlog" logEvery="10000">
      <log idref="posterior"/>
    </logger>

    <logger id="tracelog" fileName="Results/$(filebase).clock_$(clockrate).bu_$(burate).$(seed).log" logEvery="1000" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <log idref="prior"/>
      <log idref="treePrior"/>
      <log idref="treeLikelihood.alignment"/>
      <log id="treeHeight" spec="beast.evolution.tree.TreeHeightLogger" tree="@Tree.t:alignment"/>
      <log id="treeLength" spec="multitypetree.util.TreeLengthLogger" tree="@Tree.t:alignment"/>
      <log idref="clockRate.c:alignment"/>
      <log idref="origin"/>
      <log idref="samplingProportion"/>
      <log idref="becomeUninfectiousRate"/>
      <log idref="reproductiveNumber"/>
      <!-- <log idref="ReSmoothingPrecision"/> -->
      <log idref="kappa"/>
      <log idref="gammaShape"/>
    </logger>

    <logger id="treelog.t:alignment" fileName="Results/$(filebase).clock_$(clockrate).bu_$(burate).$(seed).trees" logEvery="1000" mode="tree">
        <log id="TreeWithMetaDataLogger.t:alignment" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@Tree.t:alignment"/>
    </logger>

</run>

</beast>
